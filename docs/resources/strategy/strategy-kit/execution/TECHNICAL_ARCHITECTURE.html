<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technical Architecture | Commerce.com Stack</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Dark theme - CopilotKit inspired */
            --bg-primary: #0d0a14;
            --bg-secondary: #1a1625;
            --bg-tertiary: #252033;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --accent-cyan: #a78bfa;
            --accent-orange: #f97316;
            --accent-green: #34d399;
            --accent-purple: #a78bfa;
            --accent-blue: #60a5fa;
            --border-color: #2d2640;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .layout {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            padding: 24px 0;
        }

        .sidebar-header {
            padding: 0 24px 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-header h1 {
            font-size: 15px;
            font-weight: 600;
            color: var(--accent-cyan);
            margin-bottom: 4px;
        }

        .sidebar-header .doc-type {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-section {
            padding: 16px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .nav-section-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 0 24px 8px;
        }

        .nav-link {
            display: block;
            padding: 8px 24px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 13px;
            transition: all 0.15s ease;
        }

        .nav-link:hover {
            color: var(--text-primary);
            background: rgba(167, 139, 250, 0.05);
        }

        .nav-link.active {
            color: var(--accent-cyan);
            background: rgba(167, 139, 250, 0.1);
            border-right: 2px solid var(--accent-cyan);
        }

        .sidebar-footer {
            padding: 24px;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--text-muted);
            text-decoration: none;
            font-size: 13px;
            transition: color 0.15s ease;
        }

        .back-link:hover {
            color: var(--accent-cyan);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 48px 64px;
            max-width: 1000px;
        }

        .doc-header {
            margin-bottom: 48px;
            padding-bottom: 32px;
            border-bottom: 1px solid var(--border-color);
        }

        .classification {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(168, 85, 247, 0.1);
            color: var(--accent-purple);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
        }

        .doc-header h1 {
            font-size: 32px;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 12px;
        }

        .doc-subtitle {
            font-size: 18px;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .doc-meta {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
        }

        .meta-item {
            font-size: 13px;
            color: var(--text-muted);
        }

        .meta-item strong {
            color: var(--text-secondary);
        }

        /* Sections */
        section {
            margin-bottom: 48px;
        }

        h2 {
            font-size: 22px;
            font-weight: 600;
            color: var(--accent-cyan);
            margin-bottom: 24px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 32px 0 16px;
        }

        h4 {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-secondary);
            margin: 24px 0 12px;
        }

        p {
            margin-bottom: 16px;
            color: var(--text-secondary);
        }

        /* Architecture Diagram */
        .arch-diagram {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin: 24px 0;
            overflow-x: auto;
        }

        .arch-diagram pre {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 11px;
            line-height: 1.4;
            color: var(--text-secondary);
            margin: 0;
            white-space: pre;
        }

        .arch-diagram .highlight {
            color: var(--accent-cyan);
        }

        .arch-diagram .component {
            color: var(--accent-orange);
        }

        .arch-diagram .layer {
            color: var(--accent-purple);
        }

        /* Component Cards */
        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 24px 0;
        }

        .component-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
        }

        .component-card h4 {
            margin: 0 0 8px;
            font-size: 14px;
            color: var(--text-primary);
        }

        .component-card .owner {
            font-size: 12px;
            color: var(--accent-cyan);
            margin-bottom: 8px;
        }

        .component-card p {
            font-size: 13px;
            margin: 0;
        }

        /* Code Blocks */
        pre {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 16px;
            overflow-x: auto;
            margin: 16px 0;
        }

        code {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 13px;
            color: var(--text-primary);
        }

        pre code {
            display: block;
        }

        p code {
            background: var(--bg-tertiary);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
        }

        /* Syntax highlighting */
        .keyword { color: var(--accent-purple); }
        .string { color: var(--accent-green); }
        .comment { color: var(--text-muted); }
        .type { color: var(--accent-cyan); }
        .function { color: var(--accent-orange); }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
            font-size: 13px;
        }

        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-weight: 600;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            color: var(--text-secondary);
        }

        tbody tr:hover {
            background: rgba(167, 139, 250, 0.02);
        }

        /* API Block */
        .api-block {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin: 24px 0;
            overflow: hidden;
        }

        .api-header {
            background: var(--bg-tertiary);
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .api-method {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
        }

        .api-method.get { background: rgba(34, 197, 94, 0.15); color: var(--accent-green); }
        .api-method.post { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }
        .api-method.put { background: rgba(249, 115, 22, 0.15); color: var(--accent-orange); }
        .api-method.delete { background: rgba(239, 68, 68, 0.15); color: #ef4444; }

        .api-endpoint {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 13px;
            color: var(--text-primary);
        }

        .api-body {
            padding: 20px;
        }

        /* Data Flow */
        .flow-diagram {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin: 24px 0;
        }

        .flow-row {
            display: flex;
            align-items: center;
            gap: 16px;
            margin: 16px 0;
        }

        .flow-box {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 12px 16px;
            text-align: center;
            min-width: 120px;
        }

        .flow-box h5 {
            font-size: 13px;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .flow-box p {
            font-size: 11px;
            color: var(--text-muted);
            margin: 0;
        }

        .flow-arrow {
            color: var(--accent-cyan);
            font-size: 24px;
        }

        /* Metric Cards */
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin: 24px 0;
        }

        .metric-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }

        .metric-card .value {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent-cyan);
            font-family: 'IBM Plex Mono', monospace;
        }

        .metric-card .label {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Alert Box */
        .alert-box {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 16px 20px;
            margin: 16px 0;
        }

        .alert-box h4 {
            margin: 0 0 8px;
            font-size: 14px;
            color: #ef4444;
        }

        .alert-box p {
            margin: 0;
            font-size: 13px;
        }

        /* Info Box */
        .info-box {
            background: rgba(167, 139, 250, 0.1);
            border: 1px solid rgba(167, 139, 250, 0.3);
            border-radius: 8px;
            padding: 16px 20px;
            margin: 16px 0;
        }

        .info-box h4 {
            margin: 0 0 8px;
            font-size: 14px;
            color: var(--accent-cyan);
        }

        .info-box p {
            margin: 0;
            font-size: 13px;
        }

        /* Lists */
        ul, ol {
            margin: 16px 0;
            padding-left: 24px;
            color: var(--text-secondary);
        }

        li {
            margin-bottom: 8px;
        }

        li strong {
            color: var(--text-primary);
        }

        /* Environment Table */
        .env-table {
            font-size: 12px;
        }

        .env-table code {
            background: var(--bg-primary);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <div class="layout">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1>Technical Architecture</h1>
                <div class="doc-type">Reference Specification</div>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Architecture</div>
                <a href="#overview" class="nav-link active">1. Overview</a>
                <a href="#apis" class="nav-link">2. API Specifications</a>
                <a href="#data-flows" class="nav-link">3. Data Flows</a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Infrastructure</div>
                <a href="#infrastructure" class="nav-link">4. Infrastructure</a>
                <a href="#security" class="nav-link">5. Security</a>
                <a href="#performance" class="nav-link">6. Performance</a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Operations</div>
                <a href="#monitoring" class="nav-link">7. Monitoring</a>
                <a href="#disaster-recovery" class="nav-link">8. Disaster Recovery</a>
            </div>

            <div class="sidebar-footer">
                <a href="../INDEX.html" class="back-link">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Back to Index
                </a>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <header class="doc-header">
                <div class="classification">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="16 18 22 12 16 6"/>
                        <polyline points="8 6 2 12 8 18"/>
                    </svg>
                    Technical Reference
                </div>
                <h1>Technical Architecture Specification</h1>
                <p class="doc-subtitle">Commerce.com + WordPress Integration Stack</p>
                <div class="doc-meta">
                    <span class="meta-item"><strong>Version:</strong> 1.0</span>
                    <span class="meta-item"><strong>Date:</strong> December 2025</span>
                    <span class="meta-item"><strong>Status:</strong> Authoritative</span>
                </div>
            </header>

            <!-- Architecture Overview -->
            <section id="overview">
                <h2>1. Architecture Overview</h2>

                <h3>1.1 System Context Diagram</h3>
                <div class="arch-diagram">
                    <pre>
┌─────────────────────────────────────────────────────────────────────────────┐
│                              <span class="layer">CUSTOMER LAYER</span>                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐           │
│  │   Web   │  │ Mobile  │  │   PWA   │  │  Kiosk  │  │ Social  │           │
│  │ Browser │  │   App   │  │         │  │         │  │Commerce │           │
│  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘           │
│       │            │            │            │            │                  │
└───────┴────────────┴────────────┴────────────┴────────────┴──────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           <span class="layer">EDGE LAYER (VERCEL)</span>                                │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      <span class="component">CATALYST (NEXT.JS 14)</span>                          │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐              │   │
│  │  │   Makeswift  │  │    React     │  │   Edge       │              │   │
│  │  │   Runtime    │  │  Components  │  │  Functions   │              │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘              │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  CDN: Vercel Edge Network (300+ global PoPs)                                │
│  Cache: ISR + Edge Cache + Stale-While-Revalidate                           │
└─────────────────────────────────────────────────────────────────────────────┘
                    │                               │
          ┌─────────┴─────────┐           ┌────────┴────────┐
          ▼                   ▼           ▼                 ▼
┌─────────────────────┐ ┌─────────────────────┐ ┌─────────────────────┐
│    <span class="component">BIGCOMMERCE</span>      │ │     <span class="component">WORDPRESS</span>       │ │    <span class="component">FEEDONOMICS</span>      │
│    (COMMERCE)       │ │     (CONTENT)       │ │      (DATA)         │
├─────────────────────┤ ├─────────────────────┤ ├─────────────────────┤
│ • Products          │ │ • Blog Posts        │ │ • ETL Engine        │
│ • Orders            │ │ • Landing Pages     │ │ • Channel Sync      │
│ • Customers         │ │ • Media Library     │ │ • Inventory Mgmt    │
│ • Checkout          │ │ • Custom Posts      │ │ • Feed Optimization │
│ • B2B Features      │ │ • SEO Content       │ │                     │
└─────────────────────┘ └─────────────────────┘ └─────────────────────┘
         │                       │                        │
         └───────────────────────┴────────────────────────┘
                                 │
                                 ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                         <span class="layer">INTEGRATION LAYER</span>                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐          │
│  │   ERP    │ │   OMS    │ │ Payments │ │  Email   │ │ Reviews  │          │
│  │ NetSuite │ │ShipStation│ │  Stripe  │ │ Klaviyo  │ │  Yotpo   │          │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘          │
└─────────────────────────────────────────────────────────────────────────────┘</pre>
                </div>

                <h3>1.2 Component Responsibilities</h3>
                <div class="component-grid">
                    <div class="component-card">
                        <h4>Catalyst</h4>
                        <div class="owner">Commerce.com</div>
                        <p>Frontend rendering, routing, SSR/ISR</p>
                    </div>
                    <div class="component-card">
                        <h4>Makeswift</h4>
                        <div class="owner">Commerce.com</div>
                        <p>Visual editing, page composition</p>
                    </div>
                    <div class="component-card">
                        <h4>BigCommerce</h4>
                        <div class="owner">Commerce.com</div>
                        <p>Commerce data, checkout, APIs</p>
                    </div>
                    <div class="component-card">
                        <h4>WordPress</h4>
                        <div class="owner">WPEngine</div>
                        <p>Content management, blog</p>
                    </div>
                    <div class="component-card">
                        <h4>WPGraphQL</h4>
                        <div class="owner">Open Source</div>
                        <p>WordPress headless API</p>
                    </div>
                    <div class="component-card">
                        <h4>Feedonomics</h4>
                        <div class="owner">Commerce.com</div>
                        <p>Data sync, channel management</p>
                    </div>
                </div>
            </section>

            <!-- API Specifications -->
            <section id="apis">
                <h2>2. API Specifications</h2>

                <h3>2.1 BigCommerce GraphQL Storefront API</h3>
                <div class="info-box">
                    <h4>Endpoint</h4>
                    <p><code>https://store-{hash}.mybigcommerce.com/graphql</code></p>
                </div>

                <p><strong>Authentication:</strong> Bearer token (Storefront API Token)</p>

                <div class="api-block">
                    <div class="api-header">
                        <span class="api-method post">POST</span>
                        <span class="api-endpoint">/graphql - Product Listing</span>
                    </div>
                    <div class="api-body">
                        <pre><code><span class="keyword">query</span> <span class="function">GetProducts</span>(<span class="type">$first</span>: Int!, <span class="type">$after</span>: String) {
  site {
    products(first: <span class="type">$first</span>, after: <span class="type">$after</span>) {
      pageInfo {
        hasNextPage
        endCursor
      }
      edges {
        node {
          entityId
          name
          sku
          path
          prices {
            price { value currencyCode }
            salePrice { value currencyCode }
          }
          defaultImage {
            url(width: 500)
            altText
          }
        }
      }
    }
  }
}</code></pre>
                    </div>
                </div>

                <div class="api-block">
                    <div class="api-header">
                        <span class="api-method post">POST</span>
                        <span class="api-endpoint">/graphql - Cart Operations</span>
                    </div>
                    <div class="api-body">
                        <pre><code><span class="keyword">mutation</span> <span class="function">AddToCart</span>(<span class="type">$cartId</span>: String!, <span class="type">$lineItems</span>: [CartLineItemInput!]!) {
  cart {
    addCartLineItems(input: {
      cartEntityId: <span class="type">$cartId</span>
      data: { lineItems: <span class="type">$lineItems</span> }
    }) {
      cart {
        entityId
        lineItems {
          physicalItems {
            entityId
            quantity
            productEntityId
          }
        }
      }
    }
  }
}</code></pre>
                    </div>
                </div>

                <h4>Rate Limits</h4>
                <table>
                    <thead>
                        <tr><th>Tier</th><th>Limit</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Standard</td><td>150 requests/second</td></tr>
                        <tr><td>Enterprise</td><td>Unlimited (with agreement)</td></tr>
                    </tbody>
                </table>

                <h3>2.2 WordPress GraphQL API (WPGraphQL)</h3>
                <div class="info-box">
                    <h4>Endpoint</h4>
                    <p><code>https://content.example.com/graphql</code></p>
                </div>

                <p><strong>Authentication:</strong> Optional (public queries), JWT for mutations</p>

                <div class="api-block">
                    <div class="api-header">
                        <span class="api-method post">POST</span>
                        <span class="api-endpoint">/graphql - Blog Posts</span>
                    </div>
                    <div class="api-body">
                        <pre><code><span class="keyword">query</span> <span class="function">GetPosts</span>(<span class="type">$first</span>: Int!, <span class="type">$after</span>: String) {
  posts(first: <span class="type">$first</span>, after: <span class="type">$after</span>) {
    pageInfo {
      hasNextPage
      endCursor
    }
    nodes {
      id
      databaseId
      title
      slug
      date
      excerpt
      content
      featuredImage {
        node {
          sourceUrl
          altText
        }
      }
      seo {
        title
        metaDesc
        canonical
      }
    }
  }
}</code></pre>
                    </div>
                </div>

                <h3>2.3 Feedonomics API</h3>
                <div class="info-box">
                    <h4>Endpoint</h4>
                    <p><code>https://api.feedonomics.com/v2/</code></p>
                </div>

                <div class="api-block">
                    <div class="api-header">
                        <span class="api-method post">POST</span>
                        <span class="api-endpoint">/feeds/{feed_id}/sync</span>
                    </div>
                    <div class="api-body">
                        <pre><code><span class="comment"># Trigger sync</span>
POST /feeds/{feed_id}/sync
Authorization: Bearer {api_key}

<span class="comment"># Get sync status</span>
GET /feeds/{feed_id}/status
Authorization: Bearer {api_key}

<span class="comment"># Get error report</span>
GET /feeds/{feed_id}/errors
Authorization: Bearer {api_key}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Data Flows -->
            <section id="data-flows">
                <h2>3. Data Flow Specifications</h2>

                <h3>3.1 Product Data Flow</h3>
                <div class="flow-diagram">
                    <div class="flow-row">
                        <div class="flow-box">
                            <h5>WooCommerce</h5>
                            <p>Source</p>
                        </div>
                        <span class="flow-arrow">→</span>
                        <div class="flow-box">
                            <h5>Feedonomics</h5>
                            <p>ETL</p>
                        </div>
                        <span class="flow-arrow">→</span>
                        <div class="flow-box">
                            <h5>BigCommerce</h5>
                            <p>Destination</p>
                        </div>
                    </div>
                </div>

                <h4>Transformation Rules</h4>
                <table>
                    <thead>
                        <tr><th>Source Field</th><th>Transform</th><th>Destination Field</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>post_title</code></td><td>Trim, 255 char limit</td><td><code>name</code></td></tr>
                        <tr><td><code>post_content</code></td><td>Strip shortcodes, clean HTML</td><td><code>description</code></td></tr>
                        <tr><td><code>_regular_price</code></td><td>Float, 2 decimal</td><td><code>price</code></td></tr>
                        <tr><td><code>_sale_price</code></td><td>Float, 2 decimal, nullable</td><td><code>sale_price</code></td></tr>
                        <tr><td><code>_sku</code></td><td>Uppercase, alphanumeric</td><td><code>sku</code></td></tr>
                        <tr><td><code>_stock</code></td><td>Integer</td><td><code>inventory_level</code></td></tr>
                        <tr><td><code>product_cat</code></td><td>Map to BC category ID</td><td><code>categories</code></td></tr>
                    </tbody>
                </table>

                <h3>3.2 Order Data Flow</h3>
                <div class="flow-diagram">
                    <div class="flow-row">
                        <div class="flow-box">
                            <h5>Customer</h5>
                            <p>Browser</p>
                        </div>
                        <span class="flow-arrow">→</span>
                        <div class="flow-box">
                            <h5>BigCommerce</h5>
                            <p>Checkout</p>
                        </div>
                        <span class="flow-arrow">→</span>
                        <div class="flow-box">
                            <h5>Webhooks</h5>
                            <p>Events</p>
                        </div>
                    </div>
                </div>

                <h4>Webhook Events</h4>
                <table>
                    <thead>
                        <tr><th>Event</th><th>Payload</th><th>Subscribers</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>store/order/created</code></td><td>Full order object</td><td>ERP, OMS, Email</td></tr>
                        <tr><td><code>store/order/updated</code></td><td>Order delta</td><td>ERP</td></tr>
                        <tr><td><code>store/order/statusUpdated</code></td><td>Status change</td><td>Email, Analytics</td></tr>
                        <tr><td><code>store/shipment/created</code></td><td>Shipment details</td><td>Email</td></tr>
                        <tr><td><code>store/customer/created</code></td><td>Customer object</td><td>Email, CDP</td></tr>
                    </tbody>
                </table>

                <h3>3.3 Cache Invalidation Strategy</h3>
                <pre><code><span class="comment">// pages/api/revalidate.ts</span>
<span class="keyword">export default async function</span> <span class="function">handler</span>(req, res) {
  <span class="keyword">if</span> (req.query.secret !== process.env.REVALIDATION_SECRET) {
    <span class="keyword">return</span> res.status(401).json({ message: <span class="string">'Invalid token'</span> });
  }

  <span class="keyword">const</span> path = req.query.path;

  <span class="keyword">try</span> {
    <span class="keyword">await</span> res.revalidate(path);
    <span class="keyword">return</span> res.json({ revalidated: <span class="keyword">true</span> });
  } <span class="keyword">catch</span> (err) {
    <span class="keyword">return</span> res.status(500).send(<span class="string">'Error revalidating'</span>);
  }
}</code></pre>
            </section>

            <!-- Infrastructure -->
            <section id="infrastructure">
                <h2>4. Infrastructure Specifications</h2>

                <h3>4.1 Vercel Configuration</h3>
                <pre><code><span class="comment">// vercel.json</span>
{
  <span class="string">"framework"</span>: <span class="string">"nextjs"</span>,
  <span class="string">"regions"</span>: [<span class="string">"iad1"</span>, <span class="string">"sfo1"</span>, <span class="string">"fra1"</span>, <span class="string">"hnd1"</span>],
  <span class="string">"headers"</span>: [
    {
      <span class="string">"source"</span>: <span class="string">"/(.*)"</span>,
      <span class="string">"headers"</span>: [
        { <span class="string">"key"</span>: <span class="string">"X-Content-Type-Options"</span>, <span class="string">"value"</span>: <span class="string">"nosniff"</span> },
        { <span class="string">"key"</span>: <span class="string">"X-Frame-Options"</span>, <span class="string">"value"</span>: <span class="string">"DENY"</span> },
        { <span class="string">"key"</span>: <span class="string">"X-XSS-Protection"</span>, <span class="string">"value"</span>: <span class="string">"1; mode=block"</span> }
      ]
    }
  ]
}</code></pre>

                <h4>Environment Variables</h4>
                <table class="env-table">
                    <thead>
                        <tr><th>Variable</th><th>Description</th><th>Source</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>BIGCOMMERCE_STORE_HASH</code></td><td>Store identifier</td><td>BigCommerce</td></tr>
                        <tr><td><code>BIGCOMMERCE_ACCESS_TOKEN</code></td><td>Storefront API token</td><td>BigCommerce</td></tr>
                        <tr><td><code>BIGCOMMERCE_CHANNEL_ID</code></td><td>Channel for this storefront</td><td>BigCommerce</td></tr>
                        <tr><td><code>WP_GRAPHQL_URL</code></td><td>WordPress GraphQL endpoint</td><td>WPEngine</td></tr>
                        <tr><td><code>MAKESWIFT_SITE_API_KEY</code></td><td>Makeswift integration</td><td>Makeswift</td></tr>
                        <tr><td><code>REVALIDATION_SECRET</code></td><td>ISR revalidation token</td><td>Self-generated</td></tr>
                    </tbody>
                </table>

                <h3>4.2 WordPress/WPEngine Configuration</h3>
                <h4>Required Plugins</h4>
                <ul>
                    <li>WPGraphQL (core)</li>
                    <li>WPGraphQL for ACF (if using ACF)</li>
                    <li>WPGraphQL SEO (for Yoast data)</li>
                    <li>WP Webhooks (for cache invalidation)</li>
                </ul>

                <h4>Performance Settings</h4>
                <pre><code><span class="comment">// wp-config.php additions</span>
<span class="function">define</span>(<span class="string">'WP_MEMORY_LIMIT'</span>, <span class="string">'256M'</span>);
<span class="function">define</span>(<span class="string">'WP_MAX_MEMORY_LIMIT'</span>, <span class="string">'512M'</span>);
<span class="function">define</span>(<span class="string">'GRAPHQL_DEBUG'</span>, <span class="keyword">false</span>);</code></pre>
            </section>

            <!-- Security -->
            <section id="security">
                <h2>5. Security Architecture</h2>

                <h3>5.1 API Security</h3>
                <table>
                    <thead>
                        <tr><th>Endpoint Type</th><th>Authentication</th><th>Rate Limiting</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Storefront GraphQL</td><td>Storefront Token</td><td>Per-channel</td></tr>
                        <tr><td>Management API</td><td>OAuth / API Key</td><td>Per-app</td></tr>
                        <tr><td>WordPress GraphQL</td><td>Optional JWT</td><td>Per-IP</td></tr>
                        <tr><td>Webhooks</td><td>HMAC signature</td><td>N/A</td></tr>
                    </tbody>
                </table>

                <h4>Webhook Verification</h4>
                <pre><code><span class="keyword">import</span> crypto <span class="keyword">from</span> <span class="string">'crypto'</span>;

<span class="keyword">function</span> <span class="function">verifyWebhook</span>(payload: <span class="type">string</span>, signature: <span class="type">string</span>, secret: <span class="type">string</span>): <span class="type">boolean</span> {
  <span class="keyword">const</span> hmac = crypto.createHmac(<span class="string">'sha256'</span>, secret);
  <span class="keyword">const</span> digest = hmac.update(payload).digest(<span class="string">'base64'</span>);
  <span class="keyword">return</span> crypto.timingSafeEqual(Buffer.from(signature), Buffer.from(digest));
}</code></pre>

                <h3>5.2 PCI Compliance</h3>
                <table>
                    <thead>
                        <tr><th>Requirement</th><th>Implementation</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Cardholder data storage</td><td>Never stored (BigCommerce handles)</td></tr>
                        <tr><td>Transmission encryption</td><td>TLS 1.3 everywhere</td></tr>
                        <tr><td>Access control</td><td>Role-based, audited</td></tr>
                        <tr><td>Vulnerability management</td><td>Automated scanning</td></tr>
                        <tr><td>Network security</td><td>WAF (Vercel/Cloudflare)</td></tr>
                    </tbody>
                </table>
            </section>

            <!-- Performance -->
            <section id="performance">
                <h2>6. Performance Specifications</h2>

                <h3>6.1 Target Metrics</h3>
                <div class="metric-grid">
                    <div class="metric-card">
                        <div class="value">&lt;2.5s</div>
                        <div class="label">LCP</div>
                    </div>
                    <div class="metric-card">
                        <div class="value">&lt;100ms</div>
                        <div class="label">FID</div>
                    </div>
                    <div class="metric-card">
                        <div class="value">&lt;0.1</div>
                        <div class="label">CLS</div>
                    </div>
                    <div class="metric-card">
                        <div class="value">&lt;200ms</div>
                        <div class="label">TTFB</div>
                    </div>
                    <div class="metric-card">
                        <div class="value">&lt;500ms</div>
                        <div class="label">API P95</div>
                    </div>
                </div>

                <h3>6.2 Caching Strategy</h3>
                <table>
                    <thead>
                        <tr><th>Layer</th><th>TTL</th><th>Invalidation</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Vercel Edge Cache</td><td>1 hour</td><td>On-demand revalidation</td></tr>
                        <tr><td>ISR (Next.js)</td><td>60 seconds</td><td>Webhook trigger</td></tr>
                        <tr><td>Browser Cache</td><td>1 day (static assets)</td><td>Versioned URLs</td></tr>
                        <tr><td>API Response Cache</td><td>5 minutes</td><td>Cache-Control header</td></tr>
                    </tbody>
                </table>

                <h4>ISR Configuration</h4>
                <pre><code><span class="comment">// pages/products/[slug].tsx</span>
<span class="keyword">export async function</span> <span class="function">getStaticProps</span>({ params }) {
  <span class="keyword">const</span> product = <span class="keyword">await</span> getProduct(params.slug);
  <span class="keyword">return</span> {
    props: { product },
    revalidate: 60, <span class="comment">// Revalidate every 60 seconds</span>
  };
}

<span class="keyword">export async function</span> <span class="function">getStaticPaths</span>() {
  <span class="keyword">const</span> products = <span class="keyword">await</span> getTopProducts(100);
  <span class="keyword">return</span> {
    paths: products.map(p => ({ params: { slug: p.slug } })),
    fallback: <span class="string">'blocking'</span>, <span class="comment">// Generate on-demand for other products</span>
  };
}</code></pre>
            </section>

            <!-- Monitoring -->
            <section id="monitoring">
                <h2>7. Monitoring & Observability</h2>

                <h3>7.1 Monitoring Stack</h3>
                <table>
                    <thead>
                        <tr><th>Layer</th><th>Tool</th><th>Metrics</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Application</td><td>Sentry</td><td>Errors, traces</td></tr>
                        <tr><td>Infrastructure</td><td>Vercel Analytics</td><td>Requests, bandwidth</td></tr>
                        <tr><td>Performance</td><td>Vercel Speed Insights</td><td>Core Web Vitals</td></tr>
                        <tr><td>Commerce</td><td>BigCommerce Analytics</td><td>Orders, revenue</td></tr>
                        <tr><td>Uptime</td><td>Pingdom / UptimeRobot</td><td>Availability</td></tr>
                    </tbody>
                </table>

                <h3>7.2 Alerting Rules</h3>
                <table>
                    <thead>
                        <tr><th>Condition</th><th>Severity</th><th>Action</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Error rate > 5%</td><td>Critical</td><td>Page on-call</td></tr>
                        <tr><td>P95 latency > 2s</td><td>High</td><td>Slack alert</td></tr>
                        <tr><td>Checkout failure > 1%</td><td>Critical</td><td>Page on-call</td></tr>
                        <tr><td>5xx errors > 10/min</td><td>High</td><td>Slack alert</td></tr>
                        <tr><td>Uptime < 99.9%</td><td>Critical</td><td>Page on-call</td></tr>
                    </tbody>
                </table>
            </section>

            <!-- Disaster Recovery -->
            <section id="disaster-recovery">
                <h2>8. Disaster Recovery</h2>

                <h3>8.1 Backup Strategy</h3>
                <table>
                    <thead>
                        <tr><th>Component</th><th>Frequency</th><th>Retention</th><th>Location</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>BigCommerce data</td><td>Automatic</td><td>30 days</td><td>BC infrastructure</td></tr>
                        <tr><td>WordPress database</td><td>Daily</td><td>30 days</td><td>WPEngine</td></tr>
                        <tr><td>WordPress media</td><td>Daily</td><td>30 days</td><td>WPEngine</td></tr>
                        <tr><td>Catalyst code</td><td>Git</td><td>Unlimited</td><td>GitHub</td></tr>
                    </tbody>
                </table>

                <h3>8.2 Recovery Procedures</h3>
                <h4>Catalyst Rollback</h4>
                <pre><code><span class="comment"># Rollback to previous deployment</span>
vercel rollback [deployment-url]</code></pre>

                <h4>WordPress Restoration</h4>
                <ul>
                    <li>WPEngine provides one-click restore from backups</li>
                    <li>Point-in-time recovery available</li>
                </ul>

                <h3>8.3 RTO/RPO Targets</h3>
                <table>
                    <thead>
                        <tr><th>Scenario</th><th>RTO</th><th>RPO</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Frontend outage</td><td>15 minutes</td><td>0 (stateless)</td></tr>
                        <tr><td>WordPress outage</td><td>1 hour</td><td>24 hours</td></tr>
                        <tr><td>BigCommerce outage</td><td>Dependent on BC</td><td>Dependent on BC</td></tr>
                        <tr><td>Full disaster</td><td>4 hours</td><td>24 hours</td></tr>
                    </tbody>
                </table>
            </section>

            <!-- Document Metadata -->
            <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; padding: 24px; margin-top: 48px;">
                <h4 style="margin-top: 0; font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px;">Document Metadata</h4>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 16px; font-size: 13px;">
                    <div><span style="color: var(--text-muted);">Author:</span> <span style="color: var(--text-secondary);">Architecture Team</span></div>
                    <div><span style="color: var(--text-muted);">Classification:</span> <span style="color: var(--text-secondary);">Technical Reference</span></div>
                    <div><span style="color: var(--text-muted);">Version:</span> <span style="color: var(--text-secondary);">1.0</span></div>
                    <div><span style="color: var(--text-muted);">Last Updated:</span> <span style="color: var(--text-secondary);">December 2025</span></div>
                </div>
                <p style="margin-top: 24px; padding-top: 16px; border-top: 1px solid var(--border-color); font-size: 12px; font-style: italic; color: var(--text-muted);">This specification is authoritative for technical implementation decisions.</p>
            </div>
        </main>
    </div>

    <!-- What's Next Section -->
    <section class="whats-next">
        <div class="whats-next-content">
            <div class="whats-next-label">Continue the Journey</div>
            <h2 class="whats-next-title">Next: Project Roadmap</h2>

            <a href="PROJECT_ROADMAP.html" class="next-card">
                <div class="next-card-content">
                    <div class="next-card-label">Step 3 of 4</div>
                    <div class="next-card-title">Project Roadmap</div>
                    <div class="next-card-desc">Phased delivery plan, milestones, success criteria, and resource allocation for the migration initiative.</div>
                </div>
                <div class="next-card-arrow">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
                </div>
            </a>

            <div class="related-section">
                <div class="related-label">Or explore related:</div>
                <div class="related-links">
                    <a href="PRODUCT_STRATEGY.html" class="related-link">Product Strategy</a>
                    <a href="IMPLEMENTATION_PLAYBOOK.html" class="related-link">Implementation Playbook</a>
                    <a href="../STRATEGIC_ASSESSMENT.html" class="related-link">Back to Assessment</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Sequence Navigation Bar -->
    <div class="sequence-nav">
        <a href="PRODUCT_STRATEGY.html" class="sequence-link prev">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
            <div class="sequence-text">
                <span class="sequence-label">Previous</span>
                <span class="sequence-title">Product Strategy</span>
            </div>
        </a>
        <div class="sequence-position">
            <span class="sequence-current">2</span>
            <span class="sequence-total">/ 4</span>
        </div>
        <a href="PROJECT_ROADMAP.html" class="sequence-link next">
            <div class="sequence-text">
                <span class="sequence-label">Next</span>
                <span class="sequence-title">Project Roadmap</span>
            </div>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </a>
    </div>

    <style>
        /* What's Next Section */
        .whats-next {
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            border-top: 1px solid #334155;
            padding: 4rem 2rem 8rem;
        }
        .whats-next-content {
            max-width: 700px;
            margin: 0 auto;
        }
        .whats-next-label {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.6875rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: #a78bfa;
            margin-bottom: 0.75rem;
        }
        .whats-next-title {
            font-size: 1.75rem;
            font-weight: 400;
            color: #e2e8f0;
            margin-bottom: 2rem;
        }

        /* Next Card */
        .next-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #0f172a;
            border: 2px solid #a78bfa;
            border-radius: 12px;
            padding: 1.5rem 2rem;
            text-decoration: none;
            transition: all 0.2s ease;
            margin-bottom: 2rem;
        }
        .next-card:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 24px rgba(167, 139, 250, 0.2);
        }
        .next-card-label {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.6875rem;
            font-weight: 600;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: #64748b;
            margin-bottom: 0.5rem;
        }
        .next-card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 0.5rem;
        }
        .next-card-desc {
            font-size: 0.875rem;
            color: #94a3b8;
            line-height: 1.5;
        }
        .next-card-arrow {
            color: #a78bfa;
            flex-shrink: 0;
            margin-left: 1.5rem;
        }

        /* Related Links */
        .related-section {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .related-label {
            font-size: 0.8125rem;
            color: #64748b;
        }
        .related-links {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        .related-link {
            font-size: 0.8125rem;
            color: #94a3b8;
            text-decoration: none;
            padding: 0.375rem 0.75rem;
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 6px;
            transition: all 0.2s ease;
        }
        .related-link:hover {
            color: #a78bfa;
            border-color: #a78bfa;
        }

        /* Sequence Navigation Bar */
        .sequence-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #0f172a;
            border-top: 1px solid #334155;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }
        .sequence-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
            color: #94a3b8;
            transition: color 0.2s;
        }
        .sequence-link:hover { color: #a78bfa; }
        .sequence-text { display: flex; flex-direction: column; }
        .sequence-link.next .sequence-text { text-align: right; }
        .sequence-label { font-size: 0.6875rem; text-transform: uppercase; letter-spacing: 0.05em; opacity: 0.7; }
        .sequence-title { font-size: 0.9375rem; font-weight: 500; color: #e2e8f0; }
        .sequence-position {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.875rem;
            color: #64748b;
        }
        .sequence-current { color: #a78bfa; font-weight: 600; }
        .main-content { padding-bottom: 60px; }
    </style>

    <script>
        // Active nav link highlighting on scroll
        const sections = document.querySelectorAll('section[id]');
        const navLinks = document.querySelectorAll('.nav-link');

        window.addEventListener('scroll', () => {
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (scrollY >= sectionTop - 100) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${current}`) {
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
