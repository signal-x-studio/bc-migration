<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 3: Transactions - Orders and Coupons</title>
    <meta name="description" content="Transfer order history and discount codes to BigCommerce">
    <!-- frontmatter
title: "Phase 3: Transactions - Orders and Coupons"
description: "Transfer order history and discount codes to BigCommerce"
category: "guides"
order: 3
-->
</head>
<body>

<h1>Phase 3: Transactions - Orders and Coupons</h1>

<p>The Transactions phase migrates your order history and discount codes to BigCommerce. This is an optional phase that depends on Phase 2 (Core Data) being completed first.</p>

<h2>Overview</h2>

<p>This phase migrates:</p>

<ul>
<li><strong>Orders:</strong> Complete order history with customer and product associations</li>
<li><strong>Coupons:</strong> Discount codes, rules, and restrictions</li>
</ul>

<h2>Dependencies</h2>

<p><strong>Requires Phase 2 (Core Data):</strong></p>

<ul>
<li>Orders need products to be migrated (for line items)</li>
<li>Orders need customers to be migrated (for customer associations)</li>
<li>Product and customer ID mappings from Phase 2 are used to link orders correctly</li>
</ul>

<h2>Orders Migration</h2>

<h3>What Gets Migrated</h3>

<ul>
<li><strong>Order Data:</strong> Order number, date, status, total amount</li>
<li><strong>Customer Association:</strong> Links order to migrated customer (or guest)</li>
<li><strong>Line Items:</strong> Products, quantities, prices (using product ID mapping)</li>
<li><strong>Billing Address:</strong> Complete billing address</li>
<li><strong>Shipping Address:</strong> Shipping address information</li>
<li><strong>Order Status:</strong> Mapped from WooCommerce status to BigCommerce status</li>
</ul>

<h3>Order Status Mapping</h3>

<p>WooCommerce order statuses are mapped to BigCommerce order status IDs:</p>

<table>
<thead>
<tr>
<th>WooCommerce Status</th>
<th>BigCommerce Status ID</th>
<th>BigCommerce Status Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>pending</td>
<td>1</td>
<td>Pending</td>
</tr>
<tr>
<td>processing</td>
<td>11</td>
<td>Awaiting Fulfillment / Picking</td>
</tr>
<tr>
<td>on-hold</td>
<td>7</td>
<td>Awaiting Payment</td>
</tr>
<tr>
<td>completed</td>
<td>10</td>
<td>Completed</td>
</tr>
<tr>
<td>cancelled</td>
<td>5</td>
<td>Cancelled</td>
</tr>
<tr>
<td>refunded</td>
<td>4</td>
<td>Refunded</td>
</tr>
<tr>
<td>failed</td>
<td>6</td>
<td>Declined</td>
</tr>
<tr>
<td>trash</td>
<td>5</td>
<td>Cancelled</td>
</tr>
</tbody>
</table>

<h3>Order Migration Process</h3>

<ol>
<li><strong>Fetch Orders:</strong> Retrieves orders from WooCommerce (paginated, 20 per page)</li>
<li><strong>Resolve Customer:</strong> Looks up customer by email using customer ID mapping</li>
<li><strong>Resolve Products:</strong> Maps line items to products using product ID mapping (by SKU)</li>
<li><strong>Handle Missing Products:</strong> Creates custom line items for products not found</li>
<li><strong>Transform Order:</strong> Converts WooCommerce order format to BigCommerce format</li>
<li><strong>Create Order:</strong> Creates order in BigCommerce via API</li>
</ol>

<h3>Product Resolution</h3>

<p>Order line items are resolved using the product ID mapping from Phase 2:</p>

<pre><code class="language-typescript">// For each line item
if (item.sku) {
  const productId = await bc.getProductIdBySku(item.sku);
  if (productId) {
    // Add as linked product
    products.push({
      product_id: productId,
      quantity: item.quantity,
      price_inc_tax: itemPrice
    });
  } else {
    // Add as custom item (product not found)
    products.push({
      name: item.name,
      quantity: item.quantity,
      price_inc_tax: itemPrice,
      price_ex_tax: itemPrice
    });
  }
}
</code></pre>

<h3>Customer Resolution</h3>

<p>Orders are linked to customers when possible:</p>

<pre><code class="language-typescript">let customerId = 0; // 0 = Guest order
if (order.billing.email) {
  const foundId = await bc.getCustomerIdByEmail(order.billing.email);
  if (foundId) {
    customerId = foundId; // Link to migrated customer
  }
}
</code></pre>

<h3>Delta Migration</h3>

<p>The Order Migrator supports delta (incremental) migration:</p>

<ul>
<li>Only migrates orders modified since the last run</li>
<li>Tracks last migration timestamp using <code>StateTracker</code></li>
<li>Useful for syncing ongoing order changes</li>
</ul>

<h3>Order Migration Statistics</h3>

<p>After completion, you'll receive:</p>

<ul>
<li><strong>Total:</strong> Total orders found in WooCommerce</li>
<li><strong>Migrated:</strong> Orders successfully created in BigCommerce</li>
<li><strong>Skipped:</strong> Orders that were skipped (if any)</li>
<li><strong>Failed:</strong> Orders that encountered errors</li>
<li><strong>Warnings:</strong> Any warnings (e.g., missing products, unmapped customers)</li>
</ul>

<h2>Coupons Migration</h2>

<h3>What Gets Migrated</h3>

<ul>
<li><strong>Coupon Code:</strong> Discount code string</li>
<li><strong>Discount Type:</strong> Percentage or fixed amount</li>
<li><strong>Discount Amount:</strong> Value of the discount</li>
<li><strong>Usage Limits:</strong> Minimum purchase, maximum discount, usage limits</li>
<li><strong>Restrictions:</strong> Product, category, or customer restrictions</li>
<li><strong>Expiry Date:</strong> Coupon expiration date</li>
</ul>

<h3>Coupon Migration Process</h3>

<ol>
<li><strong>Fetch Coupons:</strong> Retrieves all coupons from WooCommerce</li>
<li><strong>Transform Coupon:</strong> Converts WooCommerce coupon format to BigCommerce format</li>
<li><strong>Map Restrictions:</strong> Maps product/category restrictions using ID mappings</li>
<li><strong>Create Coupon:</strong> Creates coupon in BigCommerce via API</li>
</ol>

<h3>Coupon Transformation</h3>

<p>Coupons are transformed to match BigCommerce coupon structure:</p>

<pre><code class="language-typescript">const couponPayload = {
  name: wcCoupon.code,
  type: mapDiscountType(wcCoupon.discount_type),
  amount: wcCoupon.amount,
  min_purchase: wcCoupon.minimum_amount,
  max_discount: wcCoupon.maximum_amount,
  applies_to: mapAppliesTo(wcCoupon.product_ids, wcCoupon.excluded_product_ids),
  enabled: wcCoupon.enabled,
  expires_at: wcCoupon.expiry_date
};
</code></pre>

<h3>Coupon Migration Statistics</h3>

<p>After completion, you'll receive:</p>

<ul>
<li><strong>Total:</strong> Total coupons found in WooCommerce</li>
<li><strong>Migrated:</strong> Coupons successfully created in BigCommerce</li>
<li><strong>Skipped:</strong> Coupons that already existed (by code)</li>
<li><strong>Failed:</strong> Coupons that encountered errors</li>
</ul>

<h2>Using the Dashboard Wizard</h2>

<h3>Orders Migration</h3>

<ol>
<li>Navigate to Phase 3 in the Migration Wizard</li>
<li>Verify that Phase 2 (Core Data) is complete</li>
<li>Click <strong>Migrate Orders</strong> in the Orders section</li>
<li>Monitor progress in real-time</li>
<li>Review order migration statistics</li>
</ol>

<h3>Coupons Migration</h3>

<ol>
<li>In Phase 3, scroll to the Coupons section</li>
<li>Click <strong>Migrate Coupons</strong></li>
<li>Monitor progress in real-time</li>
<li>Review coupon migration statistics</li>
</ol>

<h3>Phase UI Features</h3>

<ul>
<li><strong>Dependency Check:</strong> Warns if products/customers haven't been migrated</li>
<li><strong>Real-time Progress:</strong> See orders and coupons being migrated</li>
<li><strong>Statistics Display:</strong> View migration results for each entity</li>
<li><strong>Skip Option:</strong> Option to skip this phase if not needed</li>
</ul>

<h2>API Endpoints</h2>

<h3>Migrate Orders</h3>

<pre><code class="language-http">POST /api/migrate/orders

Request Body:
{
  "wcCredentials": { ... },
  "bcCredentials": { ... },
  "productIdMapping": { "1": 10, "2": 11, ... },
  "customerIdMapping": { "1": 10, "2": 11, ... }
}

Response:
{
  "success": true,
  "data": {
    "total": 500,
    "successful": 495,
    "skipped": 0,
    "failed": 5,
    "warnings": ["Order 123: Product not found", ...]
  }
}
</code></pre>

<h3>Migrate Coupons</h3>

<pre><code class="language-http">POST /api/migrate/coupons

Request Body:
{
  "wcCredentials": { ... },
  "bcCredentials": { ... },
  "productIdMapping": { ... },
  "categoryIdMapping": { ... }
}

Response:
{
  "success": true,
  "data": {
    "total": 25,
    "successful": 24,
    "skipped": 1,
    "failed": 0
  }
}
</code></pre>

<h2>CLI Usage</h2>

<pre><code class="language-bash"># Migrate orders
npm run migrate -- --phase transactions \
  --wc-url https://your-store.com \
  --wc-key YOUR_KEY \
  --wc-secret YOUR_SECRET \
  --bc-hash YOUR_HASH \
  --bc-token YOUR_TOKEN

# Delta migration (only modified orders)
npm run migrate -- --phase transactions --delta
</code></pre>

<h2>Important Considerations</h2>

<h3>Order Data Limitations</h3>

<ul>
<li><strong>Payment Information:</strong> Payment details are not migrated for security reasons</li>
<li><strong>Shipping Methods:</strong> Shipping method names may need manual mapping</li>
<li><strong>Tax Information:</strong> Tax calculations may differ between platforms</li>
<li><strong>Custom Line Items:</strong> Products not found are added as custom items</li>
</ul>

<h3>Customer Association</h3>

<ul>
<li>Orders are linked to customers when email matches a migrated customer</li>
<li>Orders with unmatched emails are created as guest orders</li>
<li>Consider migrating customers before orders for better association</li>
</ul>

<h3>Product Association</h3>

<ul>
<li>Line items are linked to products using SKU matching</li>
<li>Products not found are added as custom line items</li>
<li>Ensure product SKUs are consistent between platforms</li>
</ul>

<h2>Next Phase</h2>

<p>After completing the Transactions phase, you can proceed to:</p>

<ul>
<li><strong>Phase 4: Content</strong> - Migrate reviews, pages, and blog posts (optional, requires Core Data)</li>
</ul>

<h2>Troubleshooting</h2>

<h3>Orders Not Linking to Customers</h3>

<ul>
<li>Verify customers were migrated in Phase 2</li>
<li>Check that email addresses match exactly</li>
<li>Review customer ID mapping for accuracy</li>
</ul>

<h3>Line Items Not Linking to Products</h3>

<ul>
<li>Verify products were migrated in Phase 2</li>
<li>Check that SKUs match between platforms</li>
<li>Review product ID mapping for accuracy</li>
<li>Custom items will be created for unmatched products</li>
</ul>

<h3>Order Status Issues</h3>

<ul>
<li>Review status mapping table for correct conversion</li>
<li>Check that BigCommerce status IDs are valid</li>
<li>Verify order status values in WooCommerce</li>
</ul>

<h3>Coupon Restrictions Not Working</h3>

<ul>
<li>Verify products/categories were migrated</li>
<li>Check that restriction mappings use correct IDs</li>
<li>Review coupon transformation logic</li>
</ul>

<h2>Best Practices</h2>

<ul>
<li><strong>Complete Core Data First:</strong> Ensure products and customers are migrated before orders</li>
<li><strong>Review Mappings:</strong> Verify product and customer ID mappings are accurate</li>
<li><strong>Test with Sample:</strong> Migrate a small batch of orders first</li>
<li><strong>Handle Custom Items:</strong> Review custom line items and link manually if needed</li>
<li><strong>Verify Totals:</strong> Compare order totals between platforms</li>
<li><strong>Backup:</strong> Always backup your BigCommerce store before migration</li>
</ul>

<h2>Related Documentation</h2>

<ul>
<li><a href="foundation.html">Phase 1: Foundation</a></li>
<li><a href="core-data.html">Phase 2: Core Data</a></li>
<li><a href="content.html">Phase 4: Content</a></li>
<li><a href="../step-by-step.html">Step-by-Step Migration Guide</a></li>
</ul>

</body>
</html>

